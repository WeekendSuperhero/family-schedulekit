{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Family Schedule Schema",
  "description": "Schema for defining family custody/parenting schedules with ISO 8601 week-based rules",
  "type": "object",
  "properties": {
    "version": {
      "type": "string",
      "description": "Schema version for compatibility tracking",
      "default": "1.0.0"
    },
    "parties": {
      "type": "object",
      "description": "The people involved in the custody schedule",
      "properties": {
        "guardian_1": {
          "type": "string",
          "description": "Name or identifier for first guardian"
        },
        "guardian_2": {
          "type": "string",
          "description": "Name or identifier for second guardian"
        },
        "children": {
          "type": "array",
          "items": { "type": "string" },
          "description": "List of children's names"
        }
      },
      "required": ["guardian_1", "guardian_2", "children"]
    },
    "calendar_week_system": {
      "type": "string",
      "enum": ["ISO8601"],
      "description": "Calendar week numbering system (ISO 8601 starts weeks on Monday)"
    },
    "handoff": {
      "type": "object",
      "description": "Handoff logistics and timing rules",
      "properties": {
        "default_location": {
          "type": "string",
          "description": "Default location/description for handoffs when custody changes",
          "default": "school",
          "examples": ["school", "daycare", "after school program"]
        },
        "special_handoffs": {
          "type": "object",
          "description": "Special handoff rules for specific weekdays",
          "additionalProperties": {
            "type": "object",
            "description": "A special handoff rule",
            "properties": {
              "from_guardian": {
                "type": "string",
                "enum": ["guardian_1", "guardian_2"],
                "description": "Guardian handing off custody"
              },
              "to_guardian": {
                "type": "string",
                "enum": ["guardian_1", "guardian_2"],
                "description": "Guardian receiving custody"
              },
              "time": {
                "type": "object",
                "description": "Structured time for handoff",
                "properties": {
                  "hour": {
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 23,
                    "description": "Hour (0-23)"
                  },
                  "minute": {
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 59,
                    "default": 0,
                    "description": "Minute (0-59)"
                  },
                  "use_24h": {
                    "type": "boolean",
                    "default": false,
                    "description": "Use 24-hour format (false = 12-hour AM/PM format)"
                  },
                  "by": {
                    "type": "boolean",
                    "default": false,
                    "description": "Indicates 'by this time' rather than 'at this time'"
                  }
                },
                "required": ["hour"],
                "examples": [
                  { "hour": 13, "minute": 0, "use_24h": false, "by": true },
                  { "hour": 15, "minute": 30, "use_24h": true },
                  { "hour": 18, "minute": 0 }
                ]
              },
              "description": {
                "type": "string",
                "description": "Human-readable description of the handoff"
              }
            },
            "required": ["from_guardian", "to_guardian", "time"]
          },
          "default": {}
        }
      }
    },
    "rules": {
      "type": "object",
      "description": "Custody rules based on odd/even ISO calendar weeks",
      "properties": {
        "odd_weeks": {
          "type": "object",
          "description": "Rules for all days in odd calendar weeks (CW1, CW3, CW5...)",
          "properties": {
            "monday": {
              "oneOf": [
                { "type": "string", "enum": ["guardian_1", "guardian_2"] },
                { "$ref": "#/definitions/weekday_rule" }
              ]
            },
            "tuesday": {
              "oneOf": [
                { "type": "string", "enum": ["guardian_1", "guardian_2"] },
                { "$ref": "#/definitions/weekday_rule" }
              ]
            },
            "wednesday": {
              "oneOf": [
                { "type": "string", "enum": ["guardian_1", "guardian_2"] },
                { "$ref": "#/definitions/weekday_rule" }
              ]
            },
            "thursday": {
              "oneOf": [
                { "type": "string", "enum": ["guardian_1", "guardian_2"] },
                { "$ref": "#/definitions/weekday_rule" }
              ]
            },
            "friday": {
              "oneOf": [
                { "type": "string", "enum": ["guardian_1", "guardian_2"] },
                { "$ref": "#/definitions/weekday_rule" }
              ]
            },
            "saturday": {
              "oneOf": [
                { "type": "string", "enum": ["guardian_1", "guardian_2"] },
                { "$ref": "#/definitions/weekday_rule" }
              ]
            },
            "sunday": {
              "oneOf": [
                { "type": "string", "enum": ["guardian_1", "guardian_2"] },
                { "$ref": "#/definitions/weekday_rule" }
              ]
            }
          },
          "required": [
            "monday",
            "tuesday",
            "wednesday",
            "thursday",
            "friday",
            "saturday",
            "sunday"
          ]
        },
        "even_weeks": {
          "type": "object",
          "description": "Rules for all days in even calendar weeks (CW2, CW4, CW6...)",
          "properties": {
            "monday": {
              "oneOf": [
                { "type": "string", "enum": ["guardian_1", "guardian_2"] },
                { "$ref": "#/definitions/weekday_rule" }
              ]
            },
            "tuesday": {
              "oneOf": [
                { "type": "string", "enum": ["guardian_1", "guardian_2"] },
                { "$ref": "#/definitions/weekday_rule" }
              ]
            },
            "wednesday": {
              "oneOf": [
                { "type": "string", "enum": ["guardian_1", "guardian_2"] },
                { "$ref": "#/definitions/weekday_rule" }
              ]
            },
            "thursday": {
              "oneOf": [
                { "type": "string", "enum": ["guardian_1", "guardian_2"] },
                { "$ref": "#/definitions/weekday_rule" }
              ]
            },
            "friday": {
              "oneOf": [
                { "type": "string", "enum": ["guardian_1", "guardian_2"] },
                { "$ref": "#/definitions/weekday_rule" }
              ]
            },
            "saturday": {
              "oneOf": [
                { "type": "string", "enum": ["guardian_1", "guardian_2"] },
                { "$ref": "#/definitions/weekday_rule" }
              ]
            },
            "sunday": {
              "oneOf": [
                { "type": "string", "enum": ["guardian_1", "guardian_2"] },
                { "$ref": "#/definitions/weekday_rule" }
              ]
            }
          },
          "required": [
            "monday",
            "tuesday",
            "wednesday",
            "thursday",
            "friday",
            "saturday",
            "sunday"
          ]
        }
      },
      "required": ["odd_weeks", "even_weeks"]
    },
    "holidays": {
      "type": "object",
      "description": "Date-specific overrides in YYYY-MM-DD format (DEPRECATED: use swaps instead)",
      "additionalProperties": {
        "type": "string",
        "enum": ["guardian_1", "guardian_2"]
      },
      "default": {}
    },
    "swaps": {
      "type": "object",
      "description": "Date swaps/exceptions with optional colors and notes",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "guardian": {
            "type": "string",
            "enum": ["guardian_1", "guardian_2"],
            "description": "Guardian who has custody on this swapped date"
          },
          "color": {
            "type": "string",
            "description": "Optional custom color (overrides automatic shading)",
            "examples": ["red", "gold", "coral", "#FFD700"]
          },
          "handoff": {
            "type": "string",
            "description": "Optional handoff description for this swap"
          },
          "note": {
            "type": "string",
            "description": "Optional note explaining the swap (shown in visualizations)",
            "examples": ["Christmas", "Spring break trade", "Vacation swap"]
          }
        },
        "required": ["guardian"]
      },
      "default": {}
    },
    "visualization": {
      "type": "object",
      "description": "Color palette for PNG calendar visualizations",
      "properties": {
        "guardian_1": {
          "type": "string",
          "description": "Color for guardian_1's custody days (named color or hex string)",
          "default": "hot_pink",
          "examples": ["hot_pink", "pink", "coral", "#FF1493"]
        },
        "guardian_2": {
          "type": "string",
          "description": "Color for guardian_2's custody days (named color or hex string)",
          "default": "midnight_blue",
          "examples": ["midnight_blue", "blue", "dark_blue", "#191970"]
        },
        "holiday": {
          "type": "string",
          "description": "Color for holiday overrides (named color or hex string)",
          "default": "light_blue",
          "examples": ["light_blue", "sky_blue", "gold", "#AECBF8"]
        },
        "unknown": {
          "type": "string",
          "description": "Color for unknown/error states (named color or hex string)",
          "default": "gray",
          "examples": ["gray", "light_gray", "#C8C8C8"]
        },
        "swap_shade_percent": {
          "type": "integer",
          "description": "Percentage to lighten/darken swap colors (0-100)",
          "default": 20,
          "minimum": 0,
          "maximum": 100
        },
        "start_weekday": {
          "type": "string",
          "enum": ["monday", "sunday"],
          "description": "First day of the week in PNG visualization (default: monday)",
          "default": "monday"
        }
      },
      "default": {
        "guardian_1": "hot_pink",
        "guardian_2": "midnight_blue",
        "holiday": "light_blue",
        "unknown": "gray",
        "swap_shade_percent": 20,
        "start_weekday": "monday"
      }
    }
  },
  "required": ["parties", "calendar_week_system", "handoff", "rules"],
  "definitions": {
    "weekday_rule": {
      "type": "object",
      "description": "Flexible modulo-based rule for complex schedule patterns",
      "properties": {
        "modulo_rules": {
          "type": "array",
          "description": "List of modulo conditions evaluated in order",
          "items": {
            "type": "object",
            "properties": {
              "modulo": {
                "type": "integer",
                "minimum": 2,
                "description": "Divisor for modulo operation (CW % modulo)"
              },
              "remainder": {
                "type": "integer",
                "minimum": 0,
                "description": "Target remainder value (must be < modulo)"
              },
              "guardian": {
                "type": "string",
                "enum": ["guardian_1", "guardian_2"],
                "description": "Guardian when this rule matches"
              }
            },
            "required": ["modulo", "remainder", "guardian"]
          }
        },
        "otherwise": {
          "type": "string",
          "enum": ["guardian_1", "guardian_2"],
          "description": "Fallback guardian when no modulo rules match"
        }
      },
      "required": ["modulo_rules", "otherwise"]
    }
  }
}
